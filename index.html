<!DOCTYPE html>
<html>
  <head>
    <link rel="icon" href="./resources/favicon.ico" type="image/x-icon" />
    <title>ESW | District Indicators</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,600" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css" integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:200,300,400,500,600" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/js/standalone/selectize.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.bootstrap3.min.css" rel="stylesheet">
    <link href="./animate.css" rel="stylesheet">

    <link rel="stylesheet" href="./index.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.0/css/ion.rangeSlider.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.0/js/ion.rangeSlider.min.js"></script>
  </head>

  <body>
    <div class='applicationWrap' onclick="void(0)">
      <div class="landing">
        <div class="aboutProjectOverlay">
          <div class="container landingContainer">
            <div class="row landingRow">
              <div class="col-12">
                <div class="topNav">
                  <div class="pcsw">
                    <img src="./resources/logo.png" alt="Punjab Commission on the status of women" class="pcswlogo"></img>
                    <div>
                      <p class="pcswName">PUNJAB COMMISSION ON THE</p>
                      <p class="pcswName">STATUS OF WOMEN</p>
                    </div>
                  </div>
                  <i class="far fa-times-circle"></i>
                </div>
                <div class="titleContainerMenu">
                  <p class="onTopLanding landTitle">GENERATING DATA TO ADVANCE <span class="boldTitle">WOMEN'S SOCIAL & ECONOMIC WELLBEING</span> IN PAKISTAN</p>
                  <div class="socialExplore socialExploreOverlay">
                    <span class="onTopLanding headsub">Punjab Commission on the Status of Women | Beaureu of Statistics, Punjab</i></span>
                    <div class="socIcons onTopLanding">
                      <i class="fab fa-facebook-f socIcon"></i>
                      <i class="fab fa-twitter socMidIcon socIcon"></i>
                      <i class="fas fa-link socIcon"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="imageContain">
        </div>
        <div class="landingOverlay">
        </div>
        <div class="container landingContainer">
          <div class="row landingRow">
            <div class="col-12">
              <div class="topNav">
                <div class="pcsw">
                  <img src="./resources/logo.png" alt="Punjab Commission on the status of women" class="pcswlogo"></img>
                  <div>
                    <p class="pcswName">PUNJAB COMMISSION ON THE</p>
                    <p class="pcswName">STATUS OF WOMEN</p>
                  </div>
                </div>
                <p class="aboutProject">ABOUT</p>
              </div>
              <div class="titleContainer">
                <p class="onTopLanding landTitle">GENERATING DATA TO ADVANCE <span class="boldTitle">WOMEN'S SOCIAL & ECONOMIC WELLBEING</span> IN PAKISTAN</p>
                <div class="socialExplore">
                  <span class="onTopLanding headsub">Explore district level indicators for the ESW Project<i class="fas fa-arrow-circle-down landingArrow"></i></span>
                  <div class="socIcons onTopLanding">
                    <i class="fab fa-facebook-f socIcon facebookSoc"></i>
                    <i class="fab fa-twitter socMidIcon socIcon twitterSoc"></i>
                    <i class="fas fa-link socIcon webSoc"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="scatterContainer">
        <div class="container">
          <div class="row">
            <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
              <p class="sectionHeading">Scatter Plot</p>
              <p class="sectiondescription">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            </div>
            <div class="col-sm-12 col-md-12 col-lg-3 col-xl-4 order-xl-2 order-lg-2">
              <div class="panelContainer">
                <div id="threeInputsContain">
                  <p class="subSectionHeading">Select Indicators</p>
                  <div class="input">
                    <select id="threeIndOne">
                      <option value="volvo">Volvo</option>
                      <option value="saab">Saab</option>
                      <option value="mercedes">Mercedes</option>
                      <option value="audi">Audi</option>
                    </select>
                  </div>
                  <div class="input">
                    <select id="threeIndTwo">
                      <option value="volvo">Volvo</option>
                      <option value="saab">Saab</option>
                      <option value="mercedes">Mercedes</option>
                      <option value="audi">Audi</option>
                    </select>
                  </div>
                  <div class="input">
                    <select id="threeIndThree">
                      <option value="volvo">Volvo</option>
                      <option value="saab">Saab</option>
                      <option value="mercedes">Mercedes</option>
                      <option value="audi">Audi</option>
                    </select>
                  </div>
                </div>
                <div id="selectedIndicators">
                  <p class="subSectionHeading">Showing All Divisions</p>
                  <p class="subSectionHeading">Selected Indicators</p>
                  <ul class="selectedIndicatorList">
                    <li indicatorID="threeIndOne" class="sectiondescriptionList">Indicator One</li>
                    <li indicatorID="threeIndTwo" class="sectiondescriptionList">Indicator One</li>
                    <li indicatorID="threeIndThree" class="sectiondescriptionList">Indicator One</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-sm-12 col-md-12 col-lg-9 col-xl-8 order-xl-1 order-lg-1">
              <div id="scatterContain">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="scatterContainer">
      <div class="container">
        <div class="row">
          <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
            <p class="sectionHeading">Compare two Indicators</p>
            <p class="sectiondescription">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
          </div>
          <div class="col-sm-12 col-md-12 col-lg-3 col-xl-4 order-xl-2 order-lg-2">
            <div class="panelContainer">
              <div id="threeInputsContain">
                <p class="subSectionHeading">Select Indicators</p>
                <div class="input">
                  <select id="twoIndOne">
                    <option value="volvo">Volvo</option>
                    <option value="saab">Saab</option>
                    <option value="mercedes">Mercedes</option>
                    <option value="audi">Audi</option>
                  </select>
                </div>
                <div style="width: 100%; margin-bottom: 20px;">
                  <input type="text" id="indOneMinMax" name="indicatorOne_range" value="" />
                </div>
                <div class="input">
                  <select id="twoIndTwo">
                    <option value="volvo">Volvo</option>
                    <option value="saab">Saab</option>
                    <option value="mercedes">Mercedes</option>
                    <option value="audi">Audi</option>
                  </select>
                </div>
                <div style="width: 100%;  margin-bottom: 20px;">
                  <input type="text" id="indTwoMinMax" name="indicatorTwo_range" value="" />
                </div>
              </div>
              <div id="mapSelectedIndicators">
                <p class="subSectionHeading">Selected Indicators</p>
                <ul class="selectedIndicatorList">
                  <li data-indicatorID="twoIndOne" class="sectiondescriptionList">Indicator One</li>
                  <li data-indicatorID="twoIndTwo" class="sectiondescriptionList">Indicator One</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-sm-12 col-md-12 col-lg-9 col-xl-8 order-xl-1 order-lg-1">
            <div id="mapContain">
              <div class="r-legend">
              </div>
              <div class="c-legend">
              </div>
              <svg>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-sm-12 col-md-12 col-lg-8 col-xl-8">
            <h2>Punjab Commision on the status of women</h2>
            <p class="officeContact"><i class="fas fa-map-marker-alt"></i>88 Shadman II, Lahore</p>
            <p class="officeContact"><i class="fas fa-phone"></i>+92 42 99268000-4</p>
          </div>
          <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4">
            <h2>Social</h2>
            <p class="officeContact facebookSoc footerSoc">Facebook</p>
            <p class="officeContact twitterSoc footerSoc">Twitter</p>
            <p class="officeContact webSoc footerSoc">Visit PCSW website</p>
          </div>
        </div>
      </div>
    </footer>

    <script src="./scatter.js"></script>
    <script src="./bubbleMap.js"></script>

    <script>

      $(".facebookSoc").click(function() {
        window.open('https://www.facebook.com/pcswpb', '_blank');
      });

      $(".twitterSoc").click(function() {
        window.open('https://twitter.com/pcswpb', '_blank');
      });

      $(".webSoc").click(function() {
        window.open('https://pcsw.punjab.gov.pk/', '_blank');
      });

      $(".aboutProject").click(function() {
        $('html').css("overflow-y", "hidden"); //Makes page unscrollable on full navigation menu
        $('.aboutProjectOverlay').show().addClass('animated fadeIn');
        $('.aboutProjectOverlay').css("z-index", "6");
      });

      $(".fa-times-circle").click(function() {
        $('html').css("overflow-y", "visible");
        $('.aboutProjectOverlay').removeClass('fadeIn');
        setTimeout(function () {
          $('.aboutProjectOverlay').addClass('animated fadeOut')}, 275);
      });

      $('.aboutProjectOverlay').on("animationend", function () {
        if ($(this).hasClass("fadeOut") === true) {
          $('.aboutProjectOverlay').css("z-index", "-1");
          $('.aboutProjectOverlay').removeClass('fadeOut');
        }
      })

      $('#threeIndOne').selectize({
        sortField: 'text'
      });
      $('#threeIndTwo').selectize({
        sortField: 'text'
      });
      $('#threeIndThree').selectize({
        sortField: 'text'
      });

      /*$('#twoIndOne').selectize({
        sortField: 'text'
      });
      $('#twoIndTwo').selectize({
        sortField: 'text'
      });*/


     /* $("#indTwoMinMax").ionRangeSlider({
          type: "double",
          grid: true,
          min: 1,
          max: 100,
          from: 1,
          to: 100,
      });*/

      var bubbleMap;
      var mapData;
      var defaultMapIndicators = ['Experienced physical or sexual spousal violence', 'Sought help post-violence'];
      Promise.all([d3.csv('ScatterPlotInds.csv'),d3.json('PunjabBound.geojson'),d3.json('PunjDistNoIsl.geojson')])
  		.then((data)=>{
        mapData = data[0];

  			bubbleMap = getBubbleMapCreator(data[0], data[1], data[2],'#mapContain svg', '#mapContain .r-legend', '#mapContain .c-legend');
  			bubbleMap.createMap(defaultMapIndicators[0], defaultMapIndicators[1]);

        $("#indOneMinMax").ionRangeSlider({
            type: "double",
            grid: true,
            min: 1,
            max: 100,
            from: 1,
            to: 100,
            onChange : function(data){
              console.log(data);
              //var indId = data.input[0].dataset.indId;
              var indicator = $('#twoIndOne').val();
              bubbleMap.addNumericFilter(data.from, data.to, indicator);
              bubbleMap.executeFilter();
            }
        });

        rFilter = $("#indOneMinMax").data("ionRangeSlider");

        $("#indTwoMinMax").ionRangeSlider({
            type: "double",
            grid: true,
            min: 1,
            max: 100,
            from: 1,
            to: 100,
            onChange : function(data){
              console.log(data);
              //var indId = data.input[0].dataset.indId;
              var indicator = $('#twoIndTwo').val();
              bubbleMap.addNumericFilter(data.from, data.to, indicator);
              bubbleMap.executeFilter();
            }
        });

        cFilter = $("#indTwoMinMax").data("ionRangeSlider");        

        initSelectize(mapData.columns,
          {District : true, Division : true},
          ['#twoIndOne', '#twoIndTwo'],
          'map-indicators',
          function(e){
            var rIndicator = $('#twoIndOne').val();
            var cIndicator = $('#twoIndTwo').val();

            $('[data-indicatorId=twoIndOne]').text('Radius Indicator : ' + rIndicator);
            $('[data-indicatorId=twoIndTwo]').text('Color Indicator : ' + cIndicator);

            var minR = Math.floor(bubbleMap.getMinIndVal(rIndicator));
            var maxR = Math.ceil(bubbleMap.getMaxIndVal(rIndicator));
            rFilter.update({
              min : minR,
              max : maxR,
              from : minR,
              to : maxR 
            });

            var minC = Math.floor(bubbleMap.getMinIndVal(cIndicator));
            var maxC = Math.ceil(bubbleMap.getMaxIndVal(cIndicator));
            cFilter.update({
              min : minC,
              max : maxC,
              from : minC,
              to : maxC 
            });

            bubbleMap.removeAllFilters();
            bubbleMap.executeFilter();
            bubbleMap.createCircle(rIndicator, cIndicator);

          },
          defaultMapIndicators,
          function(e){
            $('[data-indicatorId=twoIndOne]').text('Radius Indicator : ' + defaultMapIndicators[0]);
            $('[data-indicatorId=twoIndTwo]').text('Color Indicator : ' + defaultMapIndicators[1]);

            var minR = Math.floor(bubbleMap.getMinIndVal(defaultMapIndicators[0]));
            var maxR = Math.ceil(bubbleMap.getMaxIndVal(defaultMapIndicators[0]));
            rFilter.update({
              min : minR,
              max : maxR,
              from : minR,
              to : maxR 
            });

            var minC = Math.floor(bubbleMap.getMinIndVal(defaultMapIndicators[1]));
            var maxC = Math.ceil(bubbleMap.getMaxIndVal(defaultMapIndicators[1]));
            cFilter.update({
              min : minC,
              max : maxC,
              from : minC,
              to : maxC 
            });
          }
        );
  		});

      function initSelectize(options, excludeObj, selectors, groupName, cb, defaultVals, initFunc){

        options = options.filter(function(d){
          return !excludeObj[d];
        });

        /*options = options.map((d)=>{return {name : d, text : d, value : d, disable : false};});*/

        selectors.forEach(function(d,i){
          var el = $(d);

          el.attr('data-group', groupName);

          var elOptions = options.map(
              function(o){
                if(defaultVals.includes(o) && o !== defaultVals[i]){
                  return {name : o, text : o, value : o, disable : true};
                }else{
                  return {name : o, text : o, value : o, disable : false};
                }
              }
            );
          el.selectize({
            sortField : 'text',
            options : elOptions,
            disabledField: 'disable'
          });

          el[0].selectize.setValue(defaultVals[i], true);

          el.on('change', function(e){

            var selected = e.target.value;

            if(!selected){
              return;
            }

            var selectGroup = Array.from(document.querySelectorAll(`[data-group=${groupName}]`));

            selectGroup = selectGroup.filter((d)=>d !== this);

            selectGroup.forEach((e)=>{
              Object.keys(e.selectize.options).forEach((d)=>{
                var disable = d === selected;
                e.selectize.updateOption(d,{disable : disable, value : d, name : d, text : d});
              });
            });
            cb(e);
          });

          initFunc();
        });
      }

    </script>
  </body>
</html>
